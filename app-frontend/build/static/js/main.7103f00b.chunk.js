(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,a){e.exports=a.p+"static/media/profilepic.53c18c21.svg"},104:function(e,t,a){e.exports=a.p+"static/media/ico_active.383d95fd.svg"},105:function(e,t,a){e.exports=a.p+"static/media/close-btn.3d388d91.svg"},110:function(e,t,a){e.exports=a(194)},166:function(e,t){},175:function(e,t){},177:function(e,t){},194:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(25),o=a.n(r),i=a(16),c=a(28),l=a(99),p=a(24),d={loading:!1},m=Object(c.c)({chatReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_LOADER":return Object(p.a)({},e,{loading:!0});case"STOP_LOADER":return Object(p.a)({},e,{loading:!1});case"SHOW_NOTIFY":return Object(p.a)({},e,{data:{type:t.payload.type,show:!0,message:t.payload.message}});case"HIDE_NOTIFY":return Object(p.a)({},e,{data:{show:!1}});case"CURRENT_MESSAGES":return Object(p.a)({},e,{allmessages:t.payload.allmessages});case"PREVIOUS_MESSAGES":return Object(p.a)({},e,{allmessages:t.payload.allmessages.concat(e.allmessages)});case"NEW_MESSAGE":return Object(p.a)({},e,{allmessages:e.allmessages.concat(t.payload.message)});case"ACTIVE_USERS":return Object(p.a)({},e,{activeusers:t.payload.activeusers});default:return e}}}),u=Object(c.a)(l.a),g=Object(c.d)(m,u),h=a(56),v=a(8);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var f=a(20),E=a(21),y=a(22),S=a(23),N=a(215),O=a(216),b=a(219),w=a(214),j=a(46),T=a.n(j),_="http://localhost:4080",R=a(33),x=new R.a;var C=function(e){return e({type:"STOP_LOADER"})},I=function(e){if(console.log(e),e&&e.code&&(401==e.code||498==e.code))return window.location.replace("/")},A=function(e){Object(S.a)(a,e);var t=Object(y.a)(a);function a(e){var s;return Object(f.a)(this,a),(s=t.call(this,e)).nameHandleChange=function(e){s.setState({isNameError:!1,name:e.target.value})},s.groupnameHandleChange=function(e){s.setState({isGroupNameError:!1,groupname:e.target.value})},s.joingroup=function(){if(s.state.name||s.state.groupname)if(s.state.name)if(s.state.groupname){var e={name:s.state.name,groupname:s.state.groupname};s.props.joinGroup(e).then(function(e){var t={uname:s.state.name,groupname:s.state.groupname,aid:e.data.data.aid,gid:e.data.data.gid};e.data.success&&e.data.data.gid&&s.props.history.push({pathname:"/chatgroup",state:{data:t}})})}else s.setState({isGroupNameError:!0});else s.setState({isNameError:!0});else s.setState({isNameError:!0,isGroupNameError:!0})},s.state={name:"",groupname:"",isNameError:!1,isGroupNameError:!1},s}return Object(E.a)(a,[{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement(w.a,{className:"org-signup-form-heading",gutterBottom:!0},"Join chat group"),n.a.createElement("div",{className:"row center-all no-margin no-padding"},n.a.createElement(N.a,{className:"col-xl-4 col-lg-6  col-sm-6 org-login-card-container"},n.a.createElement(O.a,null,n.a.createElement("div",{className:""},n.a.createElement(w.a,{className:"org-signup-detail-title",gutterBottom:!0},"Name"),n.a.createElement("input",{type:"text",required:!0,className:this.state.isNameError?"org-signup-input-field org-err-input":"org-signup-input-field",placeholder:"Ex : pavneet",value:this.state.name,onChange:this.nameHandleChange}),this.state.isNameError?n.a.createElement("p",{className:"org-error-msg"},"Please enter your name"):null,n.a.createElement(w.a,{className:"org-signup-detail-title",gutterBottom:!0,style:{marginTop:24}},"Group Name"),n.a.createElement("input",{type:"text",required:!0,className:this.state.isGroupNameError?"org-signup-input-field org-err-input":"org-signup-input-field",placeholder:"Ex : Chat Club",value:this.state.groupname,onChange:this.groupnameHandleChange}),this.state.isGroupNameError?n.a.createElement("p",{className:"org-error-msg"},"Please enter Group name"):null,n.a.createElement(b.a,{variant:"contained",className:"org-signup-btn org-signup-detail-title-margin",onClick:this.joingroup},"Join"))))))}}]),a}(s.Component),k={joinGroup:function(e){return function(t){var a={method:"POST",data:{name:e.name,groupname:e.groupname},url:_+"/user/joingrp"};return function(e,t){e({type:"START_LOADER"})}(t),T()(a).then(function(e){return C(t),e&&e.data.success&&e.data?(x.set("a_id",e.data.data.aid,{path:"/"}),e):t({type:"SHOW_NOTIFY",payload:{type:"error",message:"Something went wrong",dispatch:t}})}).catch(function(e){var a="Something went wrong";return e.response&&e.response.statusText&&(a=e.response.statusText),e.response&&e.response.data&&e.response.data.err&&(a=e.response.data.err),e&&e.response&&e.response.data&&I(e.response.data||{}),C(t),t({type:"SHOW_NOTIFY",payload:{type:"error",message:a,dispatch:t}})})}}},H=Object(v.f)(Object(i.b)(function(e){return{}},k)(A)),M=a(44),G=a(101),W=a.n(G),U=a(102),L=a.n(U),Y=new R.a,D=function(e){var t=!1,a=Y.get("a_id");return e.account&&a==e.account._id&&(t=!0),n.a.createElement("div",null,t?n.a.createElement("div",{className:"message-box-section sent-section"},n.a.createElement("div",{className:"message-sender-name "},"You"),n.a.createElement("div",{className:"message-text"},e.msg)):n.a.createElement("div",{className:"message-box-section received-section"},n.a.createElement("div",{className:"message-sender-name"},e.account?e.account.name:null),n.a.createElement("div",{className:"message-text"},e.msg)))};function F(e){return!e||!0!==e.loading&&"true"!==e.loading?null:n.a.createElement("div",null,n.a.createElement("div",{className:"visible-loader"}))}var P=a(103),B=a.n(P),V=a(104),J=a.n(V),q=W()(_),$=(new L.a({api_key:""}),function(e){Object(S.a)(a,e);var t=Object(y.a)(a);function a(e){var s;return Object(f.a)(this,a),(s=t.call(this,e)).scrollToBottom=function(){s.messagesEnd.scrollIntoView({behavior:"smooth"})},s.handleMsgChange=function(e){s.setState({msg:e.target.value})},s.sendMessage=function(e){e.preventDefault();var t={msg:s.state.msg,aid:s.state.aid,gid:s.state.gid};s.props.sendMessage(q,t).then(function(e){s.setState({msg:""})})},s.paneDidMount=function(e){e&&e.addEventListener("scroll",s.handleScroll.bind(Object(M.a)(s)))},s.handleScroll=function(e){var t=e.target,a={aid:s.state.aid,gid:s.state.gid,tim:s.props.chatReducer.allmessages[0].createdAt,previous_msg:!0};0===t.scrollTop&&(s.setState({showLoading:!0}),s.props.fetchChatHistory(a).then(function(e){s.setState({showLoading:!1}),e.data.data.allmessages.length>14&&(t.scrollTop=parseInt(t.clientHeight/2))}))},s.getActiveUsers=function(){s.props.getActiveUser({gid:s.state.gid})},s.state={msg:"",name:s.props.history.location&&s.props.history.location.state&&s.props.history.location.state.data?s.props.history.location.state.data.name:"",groupname:s.props.history.location&&s.props.history.location.state&&s.props.history.location.state.data?s.props.history.location.state.data.groupname:"",aid:s.props.history.location&&s.props.history.location.state&&s.props.history.location.state.data?s.props.history.location.state.data.aid:"",gid:s.props.history.location&&s.props.history.location.state&&s.props.history.location.state.data?s.props.history.location.state.data.gid:"",showLoading:!1},s}return Object(E.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.scrollToBottom();var t={aid:this.state.aid,gid:this.state.gid,tim:(new Date).getTime()};this.props.joinSocket(q,t),this.props.fetchChatHistory(t),q.on("ev",function(t){e.props.messageReceived(t)}),q.on("aciveusers",function(t){console.log("hlo"),e.props.activeUsers(t)}),q.on("connect_error",function(a){e.props.joinSocket(q,t)})}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"validateMessageInput",value:function(){return!(""!==this.state.msg)}},{key:"render",value:function(){var e,t,a,s,r=this;return n.a.createElement("div",null,n.a.createElement("div",{className:"chat-box-container",style:{margin:"0 auto",maxWidth:1167}},n.a.createElement("div",{className:"group-name-section"},this.state.groupname),n.a.createElement("div",{className:"row no-padding no-margin"},n.a.createElement("div",{className:"col-sm-9 no-padding no-margin"},n.a.createElement("div",{ref:this.paneDidMount,className:"message-container"},this.state.showLoading?n.a.createElement("div",{className:"chat-loader"},"Loading...."):null,(null===(e=this.props.chatReducer)||void 0===e?void 0:e.allmessages)&&0!=this.props.chatReducer.allmessages.length?this.props.chatReducer.allmessages.map(function(e,t){return n.a.createElement(D,Object.assign({},e,{key:e._id+e.createdAt+t}))}):"",n.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(e){r.messagesEnd=e}})),n.a.createElement("div",{className:"send-message-container"},n.a.createElement("form",{onSubmit:this.sendMessage},n.a.createElement("input",{type:"text",className:"ipt-send-msg",value:this.state.msg,onChange:this.handleMsgChange}),n.a.createElement("button",{type:"submit",className:"btn-send-msg",disabled:this.validateMessageInput()},"Send")))),n.a.createElement("div",{className:"col-sm-3 no-margin",style:{padding:16}},n.a.createElement("div",null,(null===(t=this.props.chatReducer)||void 0===t?void 0:t.activeusers)&&0!=(null===(a=this.props.chatReducer)||void 0===a?void 0:a.activeusers.length)?null===(s=this.props.chatReducer)||void 0===s?void 0:s.activeusers.map(function(e){return n.a.createElement("div",{className:"active-user-section",style:{margin:"8px 0px"},key:e._id},n.a.createElement("img",{alt:"*",className:"active-user-img",onClick:r.getActiveUsers,src:B.a}),n.a.createElement("span",{className:"active-icon",style:{marginLeft:"-8px"}},n.a.createElement("img",{style:{marginTop:"20px"},src:J.a})),n.a.createElement("span",{style:{marginLeft:12}},e.name))}):"")))))}}]),a}(s.Component)),z={joinSocket:function(e,t){return function(a){e.emit("joingroup",t,function(e){if(e.err){var t="Something went wrong";return e.err&&(t=e.err),a({type:"SHOW_NOTIFY",payload:{type:"error",message:t,dispatch:a}})}})}},sendMessage:function(e,t){return function(a){return new Promise(function(s,n){t.msg&&""!==t.msg&&e.emit("newmessage",t,function(e){if(console.log(e),!e.success){var t="Something went wrong";return e.err&&(t=e.err),a({type:"SHOW_NOTIFY",payload:{type:"error",message:t,dispatch:a}})}s(e)})})}},fetchChatHistory:function(e){return function(t){var a={method:"POST",data:{aid:e.aid,gid:e.gid,lmt:15,tim:e.tim},url:_+"/user/chat_his"};return T()(a).then(function(a){if(console.log(a),a&&a.data.success&&a.data){var s=a.data.data.allmessages.reverse();return e.previous_msg?t({type:"PREVIOUS_MESSAGES",payload:{allmessages:s}}):t({type:"CURRENT_MESSAGES",payload:{allmessages:s}}),a}return t({type:"SHOW_NOTIFY",payload:{type:"error",message:"Something went wrong",dispatch:t}})}).catch(function(e){var a="Something went wrong";return e.response&&e.response.statusText&&(a=e.response.statusText),e.response&&e.response.data&&e.response.data.err&&(a=e.response.data.err),e&&e.response&&e.response.data&&I(e.response.data||{}),t({type:"SHOW_NOTIFY",payload:{type:"error",message:a,dispatch:t}})})}},messageReceived:function(e){return function(t){return new Promise(function(a,s){if(console.log(e.data),e.data.success)t({type:"NEW_MESSAGE",payload:{message:e.data.message}}),a(!0);else if(!e.data.success){var n="Something went wrong";return e.err&&(n=e.err),t({type:"SHOW_NOTIFY",payload:{type:"error",message:n,dispatch:t}})}})}},getActiveUser:function(e){return function(t){var a={method:"POST",data:{aid:e.aid,gid:e.gid,lmt:15,tim:e.tim},url:_+"/user/chat_his"};return T()(a).then(function(a){if(a&&a.data.success&&a.data){var s=a.data.data.allmessages.reverse();return e.previous_msg?t({type:"PREVIOUS_MESSAGES",payload:{allmessages:s}}):t({type:"CURRENT_MESSAGES",payload:{allmessages:s}}),a}return t({type:"SHOW_NOTIFY",payload:{type:"error",message:"Something went wrong",dispatch:t}})}).catch(function(e){var a="Something went wrong";return e.response&&e.response.statusText&&(a=e.response.statusText),e.response&&e.response.data&&e.response.data.err&&(a=e.response.data.err),e&&e.response&&e.response.data&&I(e.response.data||{}),t({type:"SHOW_NOTIFY",payload:{type:"error",message:a,dispatch:t}})})}},activeUsers:function(e){return function(t){return console.log(e),new Promise(function(a,s){if(console.log(e.data),e.data.success)console.log("tes"),t({type:"ACTIVE_USERS",payload:{activeusers:e.data.activeusers}}),a(!0);else if(!e.data.success){var n="Something went wrong";return e.err&&(n=e.err),t({type:"SHOW_NOTIFY",payload:{type:"error",message:n,dispatch:t}})}})}}},K=Object(v.f)(Object(i.b)(function(e){return{chatReducer:e.chatReducer}},z)($)),Q=a(217),X=a(218);a(97);function Z(){return n.a.createElement("div",null,n.a.createElement(Q.a,{position:"static",className:"shared-header"},n.a.createElement(X.a,{variant:"dense",className:"center-all",style:{height:56}},n.a.createElement(w.a,{className:"org-header-title",gutterBottom:!0},"Chatting App"))))}var ee=a(105),te=a.n(ee),ae=a(60),se=a.n(ae),ne=a(47),re=a.n(ne),oe=function(e){Object(S.a)(a,e);var t=Object(y.a)(a);function a(e){var s;return Object(f.a)(this,a),(s=t.call(this,e)).componentDidUpdate=function(e){e.storedata!==s.props.storedata&&("error"===s.props.type||s.props.storedata&&"error"===s.props.storedata.type?s.setState({heading:"Error",img:re.a}):"success"===s.props.type||s.props.storedata&&"success"===s.props.storedata.type?s.setState({heading:"Success",img:se.a}):"info"===s.props.type||s.props.storedata&&"info"===s.props.storedata.type?s.setState({heading:"Info",img:se.a}):"warning"===s.props.type||s.props.storedata&&"warning"===s.props.storedata.type?s.setState({heading:"Warning",img:re.a}):s.setState({heading:"Error",img:re.a}))},s.state={},s}return Object(E.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:this.props.show||this.props.storedata&&this.props.storedata.show?"error-popover":"error-popover hide-error-popover"},n.a.createElement("div",{className:"ep-icon-container"},n.a.createElement("img",{alt:"",className:"icon",src:this.state.img})),n.a.createElement("div",{className:"ep-content"},n.a.createElement("p",{className:"ep-heading"},this.state.heading),n.a.createElement("p",{className:"ep-msg"},this.props.message||this.props.storedata&&this.props.storedata.message)),n.a.createElement("div",{className:"close"},n.a.createElement("img",{alt:"close",onClick:this.props.hideAlert,className:"close-img",src:te.a})))}}]),a}(s.Component);var ie={hideAlert:function(){return function(e){e({type:"HIDE_NOTIFY",payload:{}})}}},ce=Object(v.f)(Object(i.b)(function(e){return{storedata:e.chatReducer.data}},ie)(oe)),le=(a(195),new R.a,function(e){Object(S.a)(a,e);var t=Object(y.a)(a);function a(e){var s;return Object(f.a)(this,a),(s=t.call(this,e)).state={isLoggedIn:!1},s}return Object(E.a)(a,[{key:"componentWillMount",value:function(){this.setState({isLoggedIn:!0})}},{key:"render",value:function(){return n.a.createElement("div",{className:"org-main-body"},n.a.createElement(ce,null),n.a.createElement(Z,null),n.a.createElement("div",null,n.a.createElement(F,{loading:this.props.loading}),n.a.createElement(v.c,null,n.a.createElement(v.a,{exact:!0,path:"/",render:function(){return n.a.createElement(H,null)}}),n.a.createElement(v.a,{exact:!0,path:"/chatgroup",render:function(){return n.a.createElement(K,null)}}))))}}]),a}(s.Component)),pe=(s.Component,Object(v.f)(Object(i.b)(function(e){return{loading:e.chatReducer.loading,chatReducer:e.chatReducer}},{})(le)));o.a.render(n.a.createElement(i.a,{store:g},n.a.createElement(h.a,null,n.a.createElement(v.a,{path:"/",component:pe}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}).catch(function(e){console.error(e.message)})},47:function(e,t,a){e.exports=a.p+"static/media/fail.6fe44237.svg"},60:function(e,t,a){e.exports=a.p+"static/media/success.85092b97.svg"},97:function(e,t,a){}},[[110,1,2]]]);
//# sourceMappingURL=main.7103f00b.chunk.js.map